From d6b3557c13ffb25e80e1b2dedb33de9fbf931795 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?V=C3=A1clav=20Pavl=C3=ADn?= <vpavlin@redhat.com>
Date: Thu, 15 Nov 2012 10:24:02 +0100
Subject: [PATCH] CoverityScan update

Resolves: #873636
---
 src/eths.c      |  8 ++++----
 src/pci.c       | 11 +++++++++--
 src/read_proc.c |  2 +-
 3 files changed, 14 insertions(+), 7 deletions(-)

diff --git a/src/eths.c b/src/eths.c
index 38bb7fe..1eaa6b2 100644
--- a/src/eths.c
+++ b/src/eths.c
@@ -54,7 +54,7 @@ static int eths_get_ifindex(const char *devname, int *ifindex)
 	struct ifreq ifr;
 
 	memset(&ifr, 0, sizeof(ifr));
-	strncpy(ifr.ifr_name, devname, sizeof(ifr.ifr_name));
+	strncpy(ifr.ifr_name, devname, sizeof(ifr.ifr_name)-1);
 
 	/* Open control socket. */
 	fd = socket(AF_INET, SOCK_DGRAM, 0);
@@ -77,7 +77,7 @@ static int eths_get_hwaddr(const char *devname, unsigned char *buf, int size, in
 	struct ifreq ifr;
 
 	memset(&ifr, 0, sizeof(ifr));
-	strncpy(ifr.ifr_name, devname, sizeof(ifr.ifr_name));
+	strncpy(ifr.ifr_name, devname, sizeof(ifr.ifr_name)-1);
 
 	/* Open control socket. */
 	fd = socket(AF_INET, SOCK_DGRAM, 0);
@@ -102,7 +102,7 @@ static int eths_get_info(const char *devname, struct ethtool_drvinfo *drvinfo)
 
 	/* Setup our control structures. */
 	memset(&ifr, 0, sizeof(ifr));
-	strncpy(ifr.ifr_name, devname, sizeof(ifr.ifr_name));
+	strncpy(ifr.ifr_name, devname, sizeof(ifr.ifr_name)-1);
 
 	/* Open control socket. */
 	fd = socket(AF_INET, SOCK_DGRAM, 0);
@@ -132,7 +132,7 @@ static int eths_get_permaddr(const char *devname, unsigned char *buf, int size)
 
 	/* Setup our control structures. */
 	memset(&ifr, 0, sizeof(ifr));
-	strncpy(ifr.ifr_name, devname, sizeof(ifr.ifr_name));
+	strncpy(ifr.ifr_name, devname, sizeof(ifr.ifr_name)-1);
 
 
 
diff --git a/src/pci.c b/src/pci.c
index 7a7cb36..c0759a7 100644
--- a/src/pci.c
+++ b/src/pci.c
@@ -219,10 +219,14 @@ static void set_pci_vpd_instance(struct libbiosdevname_state *state)
 
 	/* Read VPD-R on Dell systems only */
 	if ((fd = open("/sys/devices/virtual/dmi/id/sys_vendor", O_RDONLY)) >= 0) {
-		if (read(fd, sys_vendor, 9) != 9)
+		if (read(fd, sys_vendor, 9) != 9) {
+                        close(fd);
 			return;
-		if (strncmp(sys_vendor, "Dell Inc.", 9)) 
+                }
+		if (strncmp(sys_vendor, "Dell Inc.", 9)) {
+                        close(fd);
 			return;
+                }
 	} else
 		return;
 
@@ -259,6 +263,8 @@ static void set_pci_vpd_instance(struct libbiosdevname_state *state)
 			dev->vpd_pf = NULL;
 		}
 	}
+
+        close(fd);
 }
 
 static int pci_find_capability(struct pci_dev *p, int cap)
@@ -741,6 +747,7 @@ int get_pci_devices(struct libbiosdevname_state *state)
 	set_embedded_index(state);
 	set_pci_slot_index(state);
 
+out:
 	return rc;
 }
 
diff --git a/src/read_proc.c b/src/read_proc.c
index c89cb6d..eb988e9 100644
--- a/src/read_proc.c
+++ b/src/read_proc.c
@@ -25,7 +25,7 @@ static struct network_device *add_interface(struct libbiosdevname_state *state,
 		return NULL;
 	memset(i, 0, sizeof(*i));
 	INIT_LIST_HEAD(&i->node);
-	strncpy(i->kernel_name, name, sizeof(i->kernel_name));
+	strncpy(i->kernel_name, name, sizeof(i->kernel_name)-1);
 	list_add_tail(&i->node, &state->network_devices);
 	return i;
 }
-- 
1.9.0

